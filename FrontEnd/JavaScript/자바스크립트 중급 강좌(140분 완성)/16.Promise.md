# ğŸ”¥ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì¤‘ê¸‰ ê°•ì¢Œ(140ë¶„ ì™„ì„±) ì •ë¦¬

- ì‘ì„±ì¼ : 2022. 01. 24(ì›”)
- ê°•ì˜ : <a href="https://youtu.be/4_WLS9Lj6n4">ìë°”ìŠ¤í¬ë¦½íŠ¸ ì¤‘ê¸‰ ê°•ì¢Œ(140ë¶„ ì™„ì„±)</a>
- ì§„ë„ : (16) Promise

<hr>
<br>

## (16) í”„ë¡œë¯¸ìŠ¤(Promise)
```javascript
const pr = new Promise(function(resolve, reject){
    // code 
});
```
- ES6ì— ë„ì…ëœ í”„ë¡œë¯¸ìŠ¤ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ëŒ€í‘œì ì¸ ë¹„ë™ê¸° ì²˜ë¦¬ë°©ì‹ì´ë‹¤
- `resolve` ëŠ” ì‹¤í–‰ ê²°ê³¼ê°€ ì„±ê³µì¸ ê²½ìš° ì‹¤í–‰ë  í•¨ìˆ˜
- `reject` ëŠ” ì‹¤í–‰ ê²°ê³¼ê°€ ì‹¤íŒ¨ì¸ ê²½ìš° ì‹¤í–‰ë  í•¨ìˆ˜
- ì´ë ‡ê²Œ ì–´ë–¤ ì¼ì´ ì‹¤í–‰ëœ ì´í›„ ì‹¤í–‰ë  í•¨ìˆ˜ëŠ” ì½œë°±í•¨ìˆ˜ë¼ê³  ë¶€ë¥¸ë‹¤
- í”„ë¡œë¯¸ìŠ¤ì˜ ì½œë°±í•¨ìˆ˜ì— return valueë¥¼ ì¸ìë¡œ ë‹´ì•„ ì „ë‹¬í•  ìˆ˜ìˆë‹¤

<br>
<br>

![newPromise](img/newPromise.png)

- `new Promise()` ìƒì„±ìê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ëŠ” `state`ì™€ `result` í”„ë¡œí¼í‹°ë¥¼ ê°–ëŠ”ë‹¤ 
    - `state` : í”„ë¡œë¯¸ìŠ¤ì˜ ì‹¤í–‰ ê²°ê³¼ê°€ ì„±ê³µì¸ì§€ ì‹¤íŒ¨ì¸ì§€ì— ëŒ€í•œ ìƒíƒœê°’ì„ ì €ì¥í•œë‹¤
    - `result` : í”„ë¡œë¯¸ìŠ¤ì˜ ì‹¤í–‰ ê²°ê³¼ë¡œ ë°›ì•„ì˜¨ ì¸ì ê°’ì„ ë°”ì¸ë”©í•œë‹¤

<br>
<br>

![promiseResolve](img/promiseResolve.png)

- `state` ì˜ ì´ˆê¸°ê°’ì€ ëŒ€ê¸°ë¥¼ ì˜ë¯¸í•˜ëŠ” `pending` ì´ì—ˆë‹¤ê°€
    - ì‹¤í–‰ì— ì„±ê³µí•˜ë©´, ì´í–‰ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸ì˜ `fulfilled` ê°’ì„ ê°€ì§„ë‹¤
- `result` ì˜ ì´ˆê¸°ê°’ì€ `undefined` ì´ë©°
    - ì‹¤í–‰ì— ì„±ê³µí•˜ë©´, resolveì™€ í•¨ê»˜ ì „ë‹¬ë°›ì€ valueê°€ ë°”ì¸ë”©ëœë‹¤


<br>
<br>

![promiseReject](img/promiseReject.png)

- `state` ì˜ ì´ˆê¸°ê°’ì€ ëŒ€ê¸°ë¥¼ ì˜ë¯¸í•˜ëŠ” `pending` ì´ì—ˆë‹¤ê°€
    - ì‹¤í–‰ì— ì‹¤íŒ¨í•˜ë©´, ê±°ë¶€ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸ì˜ `rejected` ê°’ì„ ê°€ì§„ë‹¤
- `result` ì˜ ì´ˆê¸°ê°’ì€ `undefined` ì´ë©°
    - ì‹¤í–‰ì´ ì‹¤íŒ¨í•˜ë©´, rejectí•¨ìˆ˜ì™€ í•¨ê»˜ ì „ë‹¬ë°›ì€ errorê°€ ë°”ì¸ë”©ëœë‹¤
    - errorë¥¼ ë§Œë“¤ì–´ ë³´ë‚¼ ë•ŒëŠ” `new Error()` ì™€ ê°™ì´ `new` í‚¤ì›Œë“œì™€ `Error` ìƒì„±ìë¥¼ ì‚¬ìš©í•œë‹¤

<br>

### í”„ë¡œë¯¸ìŠ¤ì˜ then(), catch(), finally()
```javascript
console.log("êµ¬ë§¤ ì§„í–‰ ì¤‘....")

function success(item){ console.log(`${item} êµ¬ë§¤ ì„±ê³µ`); }
function fail(err){  console.log(`${error} ì—ëŸ¬ ë°œìƒ`); }

const pr = new Promise(function(resolve, reject){
    setTimeout(function(){
        resolve("ê°€êµ¬");
    }, 3000);
});

pr.then(success, fail); // ê°€êµ¬ êµ¬ë§¤ ì„±ê³µ
```
- `then()` ì„ ì‚¬ìš©í•´ `resolve` ì™€ `reject` ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤
- ì‹¤í–‰ì— ì„±ê³µí•œë‹¤ë©´, `resolve`ì˜ ì¸ìê°’ìœ¼ë¡œ ë°›ì•„ì˜¨ value(OK)ê°€ resultì— ë°”ì¸ë”©ëœë‹¤
```javascript
// pr.then(success, fail); 

pr.then(
   function(result) { console.log("SUCCESS"); } 
   function(error) { console.log("ERROR"); } 
)
```
- `then()` ì•ˆì— ìœ„ì™€ ê°™ì´ ì‹¤í–‰ì— ì„±ê³µí–ˆì„ ê²½ìš°ì™€ ì‹¤íŒ¨í•œ ê²½ìš°ë¥¼ í•œë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤
```javascript
// pr.then(success).catch(fail); 

pr.then(
   function(result) { console.log("SUCCESS"); } 
).catch(
   function(error) { console.log("ERROR"); } 
)
```
- `catch()` ë¥¼ ì¶”ê°€ë¡œ ì‚¬ìš©í•˜ì—¬ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì²˜ë¦¬í•˜ê¸°ë„ í•œë‹¤
- `catch()` ë¥¼ ì‚¬ìš©í•´ ì„±ê³µê³¼ ì‹¤íŒ¨ë¥¼ êµ¬ë¶„í•´ì£¼ëŠ” ê²ƒì´ ê°€ë…ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ê¶Œì¥í•œë‹¤
```javascript
pr.then(
   function(result) { console.log("SUCCESS"); } 
).catch(
   function(error) { console.log("ERROR"); } 
).finally(
    function() {console.log("CLEAR"); }
)
```
- `finally()` ëŠ” ì‹¤í–‰ ê²°ê³¼ì— ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰ëœë‹¤

<br>

### í”„ë¡œë¯¸ìŠ¤ì²´ì¸(PromiseChain)
```javascript
function func1(callback){
    setTimeout(function(){
        console.log("1ë²ˆ ì™„ë£Œ");
        callback();
    }, 1000);
}

function func2(callback){
    setTimeout(function(){
        console.log("2ë²ˆ ì™„ë£Œ");
        callback();
    }, 3000);
}

function func3(callback){
    setTimeout(function(){
        console.log("3ë²ˆ ì™„ë£Œ");
        callback();
    }, 2000);
}

console.log("START");

func1(function(){ 
    func2(function(){
        func3(function(){
            console.log("END");
        })
    }) 
});
```
- ì½œë°±í•¨ìˆ˜ë¥¼ ì¤‘ì²©í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì½œë°± ì§€ì˜¥ì´ë¼ê³  ë¶€ë¥¸ë‹¤

```jsx
function f1(msg) {
    console.log(msg);
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("1ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 1000);
    });
}

function f2(msg) {
    console.log(msg);
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("2ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 3000);
    });
}

function f3(msg) {
    console.log(msg);
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("3ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 2000);
    });
}

f1("START")
.then((res) => f2(res))
.then((res) => f3(res))
.then((res) => console.log(res));
```
- ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ , í”„ë¡œë¯¸ìŠ¤ì²´ì¸ì„ ì‚¬ìš©í•˜ë©´ ë” ê°„ê²°í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
```jsx
function f1(msg) {
    console.log(msg);
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("1ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 1000);
    });
}

function f2(msg) {
    console.log(msg);
    return new Promise(function(res, rej){
        setTimeout(function(){
            rej("ERROR");
        }, 3000);
    });
}

function f3(msg) {
    console.log(msg);
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("3ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 2000);
    });
}

f1("START")
.then((res) => f2(res))
.then((res) => f3(res))
.then((res) => console.log(res))
.catch((res) => console.log(res))
.finally(() => console.log("END"));
```
- `catch()` ì™€ `finally()` ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ê¸°ë„ í•œë‹¤
- `f2()` ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆê³ , ê·¸ ì´í›„ì˜ í”„ë¡œë¯¸ìŠ¤ ì²´ì¸ì€ ì‹¤í–‰ë˜ì§€ ì•Šì€ì±„ë¡œ `finally()`ê°€ ë™ì‘í•œë‹¤

<br>

### Promise.all
```jsx
function f1() {
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("1ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 1000);
    });
}

function f2() {
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("2ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 3000);
    });
}

function f3() {
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("3ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 1000);
    });
}

Promise.all([ f1(), f2(), f3() ]).then(function(res){
    console.log(res);
});

// [ '1ë²ˆ ì£¼ë¬¸ ì™„ë£Œ', '2ë²ˆ ì£¼ë¬¸ ì™„ë£Œ', '3ë²ˆ ì£¼ë¬¸ ì™„ë£Œ' ]
```
- ì—¬ëŸ¬ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ í•œë²ˆì— ì‹¤í–‰í•˜ê³ ì í•  ë•Œ `Promise.all` ì„ ì‚¬ìš©í•œë‹¤
- ì‹¤í–‰í•˜ê³ ìí•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ëŠ” ë°°ì—´ì— ë‹´ì•„ `Promise.all(arr)` ì˜ ì¸ìë¡œ ì „ë‹¬í•œë‹¤
- ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ê°€ ì¢…ë£Œë˜ì—ˆì„ ë•Œ, `then()`ì´ í•œë²ˆì— ì‹¤í–‰ëœë‹¤
- ê·¸ë ‡ê¸°ë•Œë¬¸ì— `Promise.all()` ì€ í•˜ë‚˜ì˜ ì •ë³´ë¼ë„ ëˆ„ë½ë˜ë©´(í•˜ë‚˜ë¼ë„ rejectë˜ë©´) ì—ëŸ¬ê°€ ë°œìƒí•˜ë¯€ë¡œ ì‚¬ìš©ì‹œì— ì£¼ì˜í•˜ë„ë¡ í•˜ì
 
<br>

### Promise.race
```jsx
function f1() {
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("1ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 2000);
    });
}

function f2() {
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("2ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 3000);
    });
}

function f3() {
    return new Promise(function(res, rej){
        setTimeout(function(){
            res("3ë²ˆ ì£¼ë¬¸ ì™„ë£Œ");
        }, 1000);
    });
}

Promise.race([ f1(), f2(), f3() ]).then(function(res){
    console.log(res);                   // 3ë²ˆ ì£¼ë¬¸ ì™„ë£Œ        
    console.log("END");               // END
});
```
- ëª¨ë“  í”„ë¡œë¯¸ìŠ¤ê°€ ì¢…ë£Œë˜ì—ˆì„ ë•Œ `then()` ì´ ì‹¤í–‰ë˜ëŠ” `Promise.all` ê³¼ ë‹¤ë¥´ê²Œ
- í”„ë¡œë¯¸ìŠ¤ ì¤‘ í•˜ë‚˜ë¼ë„ ì¢…ë£Œë˜ë©´ `then()` ì´ ì‹¤í–‰ëœë‹¤